<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Economy of Nothing Game‚Ñ¢</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: var(--bg-dark, #1a1a1a);
      color: var(--text-light, #f2f2f2);
      padding: 2em;
      text-align: center;
    }
    h1 {
      color: var(--accent-orange, #f26a2e);
    }
    #log {
      margin-top: 1em;
      height: 200px;
      overflow-y: scroll;
      border: 1px solid #444;
      padding: 1em;
      background: #111;
    }
    button {
      font-size: 1.5em;
      padding: 0.5em 1em;
      background: var(--accent-orange, #f26a2e);
      color: white;
      border: none;
      cursor: pointer;
    }
    .stat {
      margin: 1em;
      font-size: 1.2em;
    }
    #leaderboard {
      margin-top: 2em;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    footer {
      margin-top: 3em;
      font-size: 0.8em;
      opacity: 0.6;
    }
    footer a {
      color: #f26a2e;
    }
  </style>
</head>
<body>
  <h1>The Economy of Nothing Game‚Ñ¢</h1>
  <p><em>The official compliance simulator of the Nothing Corporation. Fun is mandatory. Results are permanent.</em></p>

  <p class="stat">üìç Position: <span id="position">0</span></p>
  <p class="stat">üíµ Money: $<span id="money">100</span></p>
  <p class="stat">üìâ Debt: $<span id="debt">0</span></p>

  <button id="rollBtn" onclick="rollDice()">üé≤ ADVANCE YOUR CAREER</button>

  <div id="log"></div>

  <div id="leaderboard">
    <h2>üìä Leaderboard (This Session)</h2>
    <ol id="scoreList"></ol>
  </div>

  <footer>
    <p><a href="/podcast/007-pay-to-lose.html">‚Üê Return to Episode Page</a></p>
    <p>¬© 56.009 Nothing Inc. | This simulation is for entertainment, training, and disciplinary use.</p>
  </footer>

  <script>
    let position = 0;
    let money = 100;
    let debt = 0;
    let gameOver = false;
    let scoreList = [];

    const gameOverMessages = [
      "Jailed for Insufficient Funds.",
      "Ejected from the Economy for Lack of Value.",
      "Died of No Money.",
      "Fired for Insolvency.",
      "Your Credit Score Was Negative.",
      "Liquidated by Dispatch.",
      "Recycled as Emotional Nutrients."
    ];

    const fallbackEvents = [
      { type: "money", amount: -15, text: "Charged a 'vibe adjustment' fee. Deducted $15 for 'team morale'." },
      { type: "money", amount: 10, text: "Received a merit-based micro-raise (+$10). Performance under review." },
      { type: "debt", amount: 5, text: "Issued a promotional debt voucher (+$5). Redemption pending liquidation." },
      { type: "debtPercent", percent: 0.1, text: "Your debt gained sentience. Compounded accordingly." },
      { type: "neutral", text: "Nothing happened. Time was extracted for corporate use." }
    ];

    function log(msg) {
      const logDiv = document.getElementById("log");
      logDiv.innerHTML += `<p>‚ñ∂ ${msg}</p>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateLeaderboard(finalScore) {
      scoreList.push(finalScore);
      scoreList.sort((a, b) => b.money - a.money);
      const list = document.getElementById("scoreList");
      list.innerHTML = "";
      scoreList.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `Space ${s.position}, $${s.money.toFixed(2)} cash, $${s.debt.toFixed(2)} debt`;
        list.appendChild(li);
      });
    }

    function resetGame() {
      updateLeaderboard({ position, money, debt });
      position = 0;
      money = 100;
      debt = 0;
      gameOver = false;
      document.getElementById("position").textContent = position;
      document.getElementById("money").textContent = money.toFixed(2);
      document.getElementById("debt").textContent = debt.toFixed(2);
      document.getElementById("log").innerHTML = "";
      document.getElementById("rollBtn").disabled = false;
      document.getElementById("rollBtn").focus();
    }

    async function fetchEvent() {
      try {
        const res = await fetch('/events.json');
        const events = await res.json();
        return events[Math.floor(Math.random() * events.length)];
      } catch (err) {
        return fallbackEvents[Math.floor(Math.random() * fallbackEvents.length)];
      }
    }

    async function rollDice() {
      if (gameOver) return;

      const roll = Math.floor(Math.random() * 6) + 1;
      position += roll;

      const event = await fetchEvent();
      let resultMsg = `You rolled a ${roll}. Advanced to tile ${position}. `;

      if (event.type === "money") {
        money += event.amount;
        resultMsg += event.text;
      } else if (event.type === "debt") {
        debt += event.amount;
        resultMsg += event.text;
      } else if (event.type === "debtPercent") {
        const interest = debt * event.percent;
        debt += interest;
        resultMsg += `${event.text} (+$${interest.toFixed(2)} debt)`;
      } else {
        resultMsg += event.text;
      }

      if (money < 0) {
        const msg = gameOverMessages[Math.floor(Math.random() * gameOverMessages.length)];
        resultMsg += `\nüõë GAME OVER: ${msg}`;
        gameOver = true;
        document.getElementById("rollBtn").disabled = true;

        setTimeout(() => {
          log(resultMsg);
          log(`üèÅ Final Position: ${position}, üíµ $${money.toFixed(2)}, üìâ $${debt.toFixed(2)}`);
          setTimeout(() => {
            log("üí∏ Resetting simulator...");
            setTimeout(resetGame, 2000);
          }, 2000);
        }, 500);
      }

      document.getElementById("position").textContent = position;
      document.getElementById("money").textContent = money.toFixed(2);
      document.getElementById("debt").textContent = debt.toFixed(2);
      log(resultMsg);
    }
  </script>
</body>
</html>
