<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Connect with The Economy of Nothing team and fellow fans. Leave a message or explore the community!">
    <meta name="keywords" content="Message Board, Economy of Nothing, Community, Connect">
    <meta name="author" content="The Economy of Nothing Team">
    <title>People of Nothing</title>
    <link rel="stylesheet" href="/style.css">
    <script defer>
        document.addEventListener("DOMContentLoaded", () => {
            const messageForm = document.getElementById("message-form");
            const messageList = document.getElementById("message-list");

            // Fetch messages from the backend
            function fetchMessages() {
                fetch("/.netlify/functions/message-board")
                    .then(response => response.json())
                    .then(messages => {
                        messageList.innerHTML = ""; // Clear the list
                        messages.forEach(({ username, message, timestamp }) => {
                            const listItem = document.createElement("li");
                            listItem.innerHTML = `<strong>${username}:</strong> ${message} <br><small>${new Date(timestamp).toLocaleString()}</small>`;
                            messageList.appendChild(listItem);
                        });
                    })
                    .catch(error => {
                        console.error("Failed to fetch messages:", error);
                        messageList.innerHTML = "<li>Error loading messages.</li>";
                    });
            }

            // Post a new message
            messageForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const username = document.getElementById("username").value.trim();
                const message = document.getElementById("message").value.trim();

                if (!username || !message) {
                    alert("Both username and message are required!");
                    return;
                }

                fetch("/.netlify/functions/message-board", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, message }),
                })
                    .then(response => response.json())
                    .then(() => {
                        fetchMessages(); // Refresh the message list
                        messageForm.reset(); // Clear the form
                    })
                    .catch(error => console.error("Failed to post message:", error));
            });

            // Initial fetch
            fetchMessages();
        });
    </script>
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>People of Nothing</h1>
        <p>Connect with The Economy of Nothing team and community.</p>
    </header>

    <!-- Navigation Section -->
    <nav>
        <a href="/index.html">Home</a>
        <a href="/episodes/index.html">Episodes</a>
        <a href="/codex.html">Codex</a>
        <a href="/pizzaparty/index.html">Pizza Party</a>
    </nav>

    <!-- Main Content Section -->
    <main>
        <!-- Message Board -->
        <section id="message-board-section">
            <h2>Message Board</h2>
            <p>Share your thoughts or connect with others in the community:</p>

            <div id="messages-container" class="shared-box">
                <ul id="message-list">
                    <li>Loading messages...</li>
                </ul>
            </div>

            <form id="message-form" class="shared-box">
                <label for="username">Your Name:</label>
                <input type="text" id="username" name="username" placeholder="Enter your name" required>

                <label for="message">Your Message:</label>
                <textarea id="message" name="message" placeholder="Write your message here" required></textarea>

                <button type="submit" class="game-option">Post Message</button>
            </form>
        </section>
    </main>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 56.009 Nothing Inc. Share, connect, and engage!</p>
    </footer>
</body>
</html>

